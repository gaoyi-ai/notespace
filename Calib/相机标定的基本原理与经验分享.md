# 坐标系

1. 世界坐标系：代表物体在真实世界里的三维坐标，坐标系用X_w , Y_W, Z_w表示。 
2. 相机坐标系：代表以相机光学中心为原点的坐标系，光轴与Z轴重合， 坐标系用X_c, Y_c, Z_c表示 
3. 图像坐标系：代表相机拍摄图像的坐标系，原点为相机光轴与成像平 面的交点，是图像的中心点，坐标系用X,Y表示。 
4. 像素坐标系：由于图像的基本单位是像素，所以该坐标系是图像上点 在图像储存矩阵中的像素位置，坐标原点在左上角，坐标系用u, v 表示。前三个坐标系的单位是毫米，而最后一个坐标系的单位是像素。

# 相机标定要标定什么？

- 内参：fx fy cx cy k1 k2 k3 p1 p2
- 外参：R t

# Zhang

三维点经过相机模型之后，从三维投影到二维，是不是可以去优化所有的这些参数，直到投影出来的点和二维上检测到的角点重合，或者说在最小二乘的意义下解出近似解？×

目标函数：
$$
\sum_{i=1}^{n} \sum_{j=1}^{m}\left\|\mathbf{m}_{i j}-\hat{\mathbf{m}}\left(\mathbf{A}, \mathbf{R}_{i}, \mathbf{t}_{i}, \mathrm{M}_{j}\right)\right\|^{2}
$$

> 直接用最优化方法去做为什么不行？
>
> 要优化的量太多，如果初始值不好很容易陷入局部最优。
>
> 内参：4+4
> 外参：每一张照片就会增加三个未知量R，三个未知量T

Zhang最大的贡献是通过数值解法。解得一个比较准确的初始值，使得后面做最优化的方法会有一个非常好的一个初始值，所以最后的结果是比较准的。所以要明确张正友的方法的贡献到底是什么，不是提出一个这样的目标函数，而是在于先解出了一个非常好的一个数值解，这个解可以用作初始值，用作后面的优化。

在得到一个初值之后，再使用最小二乘优化目标函数，为什么要再做这一步呢？因为得到的这些初始值，它是在代数意义下的最优值，并不代表比较好的物理含义，它的物理含义还是需要将一个三维点把它投影到二维图像上，然后和二维本身拍摄出来的照片上面的角点求差值，这个才是真正具有物理含义的量，把这个量进行最优化，那么最后得到的优化出来的结果，得到内参和外参就是一个比较好的结果。

# 圆与棋盘格

1. 圆检测精度高，表现为中心拟合精度高，但是具有偏心误差
2. 棋盘格检测精度低，但是不存在偏心误差

为什么圆的标定精度比正方形的要好一点，内在的因素是在于特征检测，就是圆的特征检测的精度和鲁棒性是比正方形要好的，就是正方形检测的其实是边缘，检测的是两个直线的边缘交于一点，然后把这一点作为角点提取出来。圆把圆的周围的边缘检测出来之后进行一个拟合，拟合出来它的圆心，或者说现在还有用梯度的方法去做的。

## 偏心误差

> 空间中两条直线的交点它的投影是投影直线的交点
>
> 直线的话，不管在哪个角度去拍摄，它一定是成立这个关系的，所以说直线就不存在偏心误差

圆的中心的投影不等于投影椭圆的中心。

标定板经过相机拍摄之后，它的中心究竟投影在哪里呢？当要检测时，标定板的照片它上面会是一个椭圆。那么这些椭圆，一般采取的方式是直接把椭圆的中心给他找出来，把中心作为输入的，类似于棋盘格的交点，就是输入的二维点来标定，那这样的话就引入了较大的偏心误差，因为这一个点并不是需要的点，它是偏离圆的投影的中心。

> Datta, A., Kim, J.-S., & Kanade, T. (2009). Accurate camera calibration using iterative refinement of control points. *2009 IEEE 12th International Conference on Computer Vision Workshops, ICCV Workshops*. https://doi.org/10.1109/ICCVW.2009.5457474

# 实际操作

## 拍摄机位和数量的选择

![image-20220608080354243](images/%E7%9B%B8%E6%9C%BA%E6%A0%87%E5%AE%9A%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86%E4%B8%8E%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB/image-20220608080354243.png)

**Note**

1. 拍摄的照片应该可以覆盖到整个相机的成像范围

    不要每一次拍的照片永远是放在正中间拍，周围的区域也需要去顾及到，因为相机的畸变参数，越是边角的畸变参数越严重，如果永远是在中间进行标定的话，最后很有可能出现一个结果，就是畸变参数标定不准。

2. 一张图片上的特征点数目会有多大影响，一般来说，不管是棋盘格还是还是圆环，它其实都是一个矩形阵列，那么矩形阵列的长乘宽，就设置成两个质数

## 标定结果的评判标准

利用刚刚已经标定出来的内参和外参，再把标定时候的这些三维点进行一个投影，投影到二维再和二维上检测点进行一个比对。那么它的误差其实是不是能反映出来，这个标定的参数准还是不准？其实这个就是重投影误差。

重投影误差涉及方面：

1. 图像的检测精度，即角点检测精度
2. 相机本身存在噪声
3. 和相机的分辨率有关系
    重投影误差的单位是像素，分辨率大的相机就会比分辨率小的重投影误差大
4. 优化算法

### 其他的评判标准

利用图像上的点在反向投影回到3D，测量这两个距离是不是机械设计的距离。

重投影误差，它只能反映优化函数的一个残差，物理含义其实没有这么明确。

# 背光板与图像锐度

特征点检测的基础是直线圆特征的检测，而特征检测直接和梯度挂钩

特征的理想成像边缘是阶跃的边缘（0-255），但是在实际成像中是不可能达到这样的效果的，在前景与背景中间会有一段过渡带（过渡带越长，检测精度的影响越大）。我们引入锐度的概念来表示特征边缘的锐利程度，这和边缘的亮度值相关。锐度值可以反映出图像的成像质量。

透明的带背光的标定板的好处：

1. 打光均匀（避免中间亮，边缘黑）
2. 相机的曝光时间减少，光圈可以调小（仅在测量时使用）
    1. 曝光时间减少就是防止外界环境光对整体成像的一个影响。
    2. 光圈越大，景深越小，如果景深太小，再动相机或者动标定板的过程中，很有可能把相机或者标定板超出它的景深范围，那么照片就是模糊的


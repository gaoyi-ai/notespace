---
title: LU 分解
categories:
- Math
- Linear Algebra
tags:
- LU
- PLU
- LDU
date: 2021/3/18 08:00:00
updated: 2021/3/18 21:00:00
---



在线性代数中， LU 分解 (LU Decomposition) 是矩阵分解的一种，可以将一个矩阵分解为一个单位下三角矩阵和一个上三角矩阵的乘积（有时是它们和一个置换矩阵的乘积）。LU 分解主要应用在数值分析中，用来解线性方程、求反矩阵或计算行列式。

## 什么是 LU 分解

如果有一个矩阵 A，将 A 表示成下三角矩阵 L 和上三角矩阵 U 的乘积，称为 A 的 LU 分解。

 ![](https://gitee.com/gaoyi-ai/image-bed/raw/master/images/1203675-20180829172046678-2067287514.png)

更进一步，我们希望下三角矩阵的对角元素都为 1：

 ![](https://gitee.com/gaoyi-ai/image-bed/raw/master/images/1203675-20180829172046678-2067287514.png)

一旦完成了 LU 分解，解线性方程组就会容易得多。

## LU 分解的步骤

对于满秩矩阵 A 来说，通过左乘一个消元矩阵，可以得到一个上三角矩阵 U。

![](https://gitee.com/gaoyi-ai/image-bed/raw/master/images/1203675-20180829172115707-820410842.png)

可以看到，L 实际上就是消元矩阵的逆。容易知道二阶矩阵的逆：

$$
E_{21}{ }^{-1}=\left[\begin{array}{ll}
1 & 0 \\
4 & 1
\end{array}\right]=L
$$
现在假设 A 是一个 3×3 矩阵，在不考虑行交换的情况下，通过消元得到上三角矩阵的过程是：

$$
\begin{array}{c}
\left(E_{33} E_{31} E_{21}\right) A=U \\
A=\left(E_{33} E_{31} E_{21}\right)^{-1} U=E_{21}^{-1} E_{31}^{-1} E_{32}^{-1} U=L U
\end{array}
$$

### LU伪代码

```
U = A, L = I
for j = 1 : n - 1 do
    for i = j + 1 : n do
        l_ij = u_ij / u_jj
        for k = j : n do
            u_ik = u_ik - l_ij * u_jk
        end for
    end for
end for
```

## LU 分解的前提

并非所有矩阵都能进行 LU 分解，能够 LU 分解的矩阵需要满足以下三个条件：

1.  矩阵是方阵（但是LU 分解同样适用于非方阵）；
2.  矩阵是可逆的，也就是该矩阵是满秩矩阵，每一行都是独立向量；
3.  消元过程中没有 0 主元出现，也就是消元过程中不能出现行交换的初等变换。

LU 分解的意义
--------

LU 分解的意义在于求解大型方程组。一个方程组可以简化为 Ax = b 的形式，其中 A 是 n 阶方阵，x 是未知数组成的向量，b 是 n×1 矩阵。

分解后，等式$Ax=b$可以写成，$L(Ux)=b$这样我们令$y=Ux$，这样就可以通过分开求解两个等式来得到$x$：

$$
Ly=b \\ Ux=y
$$
即可以先通过$Ly=b$求出$y$，最后再用$Ux=y$，求出$x$。

*   本质上，$LU$分解是高斯消元法的一种表达方式

以往求解的方式有两种，一是高斯消元法，二是对 A 求逆，使得 $x = A^{-1}b$。第二种方式远比消元法复杂，先看一下消元法的计算量。假设 A 是 n 阶满秩方阵，如果不写成增广矩阵，即不考虑 b，那么第一次消元达到的效果是：

 ![](https://gitee.com/gaoyi-ai/image-bed/raw/master/images/1203675-20180829172236678-1361079808.png)

其中方块是 A 原来的元素，0 是达到的效果，三角是经过消元运算后改变的元素。以第二行为例，为了使第一个元素为 0，需要让第一行乘以某个数（第一行 n 个元素，共进行了 n 次乘法运算），再将第一行和第二行相加或相减（第二行 n 个数与第一行的 n 个数相加，共进行了 n 次加法运算）。如果把一组乘法和加法看成一次运算，那么第二行的消元共进行了 n 次运算；共有 n-1 行需要类似运算，所以第一次消元共进行了 n(n - 1) ≈ n^2^ 次运算。依次类推，第二次消元共进行了 (n - 1)(n - 2) ≈ (n - 1)^2^ 次运算…… 消元到最后，变成了上三角矩阵 U，总运算次数是：
$$
\begin{array}{c}
N=n^{2}+(n-1)^{2}+(n-2)^{2}+\cdots+2^{2}+1^{2} \\
\text { set } \Delta n=1 \\
N \approx \int_{1}^{n} n^{2} d n \approx \frac{1}{3} n^{3}
\end{array}
$$
经过约 $\frac{1}{3}n^3$ 次运算后可以得到上三角矩阵 U，由于是增广矩阵，所以可以逐步求解 x。

LU 分解的运算过程和高斯消元类似，首先经过 $\frac{1}{3}n^3$  次运算将 A 变成 LU，使 Ax = b 变成 (LU)x = L(Ux) = b，再对 L 求逆，使得 $Ux = L^{-1}b$，最后求解。

接下来我们来思考一下算法效率的问题, 假如我们有一个 $100 * 100$ 的矩阵，并且各项均非0，那我们 需要计算多少次才能得到矩阵 $U$ 呢?
对于这个问题我们先从列的角度来考虑, 第一列消元运算结束以后，矩阵变为:
这一步中，第一列的元素运算了 100 次，而第一行共有100 个元素, 于是仅第一行与第一列消元结束 后, 我们就计算了 $100^{2}$ 次。之后我们要研究剩下的 $99 * 99$ 的矩阵，以此类推可知，最后的计算量为 $\sum_{k=1}^{n} k^{2}$
接着, 我们可以利用微积分计算得到, $A$ 的操作次数为 $\frac{1}{3} n^{3}, \quad b$ 的操作次数为 $n^{2}$ 次。
结合上文伪代码, 因为有三重循环嵌套, 因此LU分解的复杂度为 $O\left(n^{3}\right)$, 其中加法操作为 $\frac{1}{3} n^{3}$, 乘 法操作为 $\frac{1}{3} n^{3},$ 总共为 $\frac{2}{3} n^{3}$ 次, 求解 $b$ 和 $y$ 各需要 $n^{2}$ 次

看起来比高斯消元经历了更多的步骤，那为什么又说 LU 分解更快呢？在实践中，b 是输出，输出又经常变动，从 Ax = b 频繁地变成 Ax = b’，此时高斯消元就需要全部重新计算（高斯消元用增广矩阵消元，变化过程是 [A, b]→[U, b’]），这对大型矩阵来说及其耗时。反观 LU 分解，因为它不依赖于 b，所以计算一次后就可以存储 U 和 $L^{-1}$，在输出变化后也只是需要简单的相乘。实际上，由于 L 已经是整理过的斜对角全是 1 的下三角矩阵，所以用高斯 - 约旦消元法对 L 求逆非常简单。

LUD 分解（**LDU Decomposition**）
-----------------------------

上文中我们已经得到了$A=LU$，我们还可以继续分解下去得到$A=LDU$，D为**对角矩阵 (Diagonal Matrix)**，矩阵的$LDU$分解是在$LU$分解之后，把U再次分解，目的是把U的对角线元素都化为1，上文示例中我们得到的$A=LU$如下

$$
A = \left[\begin{array}{ccc|c} 1 & -2 & 1 & 0 \\ 0 & 2 & -8 & 8 \\ 5 & 0 & -5 &10 \end{array}\right] = LU = \left[\begin{matrix} 1 & 0 & 0 \\ 0 & 1 & 0 \\ 5 & 5 & 1 \end{matrix}\right]\left[\begin{array}{ccc|c} 1 & -2 & 1 & 0 \\ 0 & 2 & -8 & 8 \\ 0 & 0 & 30 & -30 \end{array}\right]
$$
接下来，让U矩阵中位于对角线上的元素都为1，就可以提出一个对角矩阵D

$$
LU = \left[\begin{matrix} 1 & 0 & 0 \\ 0 & 1 & 0 \\ 5 & 5 & 1 \end{matrix}\right]\left[\begin{array}{ccc|c} 1 & -2 & 1 & 0 \\ 0 & 2 & -8 & 8 \\ 0 & 0 & 30 & -30 \end{array}\right] =\left[\begin{matrix} 1 & 0 & 0 \\ 0 & 1 & 0 \\ 5 & 5 & 1 \end{matrix}\right]\left[\begin{matrix} 1 & 0 & 0 \\ 0 & 2 & 0 \\ 0 & 0 & 30 \end{matrix}\right]\left[\begin{array}{ccc|c} 1 & -2 & 1 & 0 \\ 0 & 1 & -4 & 4 \\ 0 & 0 & 1 & -1 \end{array}\right]=LDU
$$


LUP 分解（LU Decomposition with Partial Pivoting）
----------------------------------------------

我们来考虑一个矩阵$A=\left[\begin{matrix} 0 & 1 \\ 1 & 1 \end{matrix}\right]$，尽管矩阵A非奇异，并且很简单，但是使用$LU$分解的算法会失败，因为第一个主元$A_{0,0} = 0$。在高斯消元法中，我们常常通过人为的行变换来消除主元为0时的影响。例如我们需要把矩阵 A 的第一行和第二行进行交换得到$A=\left[\begin{matrix} 0 & 1 \\ 1 & 1 \end{matrix}\right]$，这样我们就能将消元进行下去。这样的操作也可以用矩阵相乘的方法来表达，那么在该示例中，即为$PA=\left[\begin{matrix} 0 & 1 \\ 1 & 0 \end{matrix}\right]\left[\begin{matrix} 0 & 1 \\ 1 & 1 \end{matrix}\right]=\left[\begin{matrix} 1 & 1 \\ 0 & 1 \end{matrix}\right]$，这里的矩阵$P$称为**置换矩阵（Permutation Matrix）**。那么就有了 **LUP 分解（LU decomposition with partial pivoting）**：$PA=LU$。这一算法的出现显著改善了$LU$分解算法的稳定性。置换矩阵P的性质，$P^{-1} = P^T$
---
title: Complexity & Technical Debt 复杂度和技术负债
categories:
- SE
tags:
- Technical Debt
date: 2021/6/25
---



## Gall's Law

> Gall's Law: “A complex system that works is invariably found to have evolved from a simple system that worked. The inverse proposition also appears to be true: a complex system designed from scratch never works and cannot be made to work. You have to start over, beginning with a simple system.” - John Gall

Gall's Law说的是所有现在复杂的系统都是由一个简单但是有效的系统进化过来的，如果我们想要建立一个复杂并且有效的系统，需要先建立一个更加简单的系统并且不断的提高和进化。反过来也一样，从头开始做一个非常复杂的系统行不通，需要从最简单的开始。

举个例子，马爸爸的阿里巴巴现在就是一个非常复杂并且有效的系统，包括了淘宝，支付宝等等等，不过阿里巴巴创立的初期并不是就包含了现在所有的复杂系统，一开始成立的时候推出专注于国内批发贸易的中国交易市（现称“1688”），后来有了不少用户证明这套系统有效之后开始一步步有了淘宝，淘宝刚开始也不是像现在这样子万能，什么都有，而是从最简单的开始一步一步建立起来的。

如果我们想要模仿重新建立一个阿里巴巴，八成会失败，我们现在看到的是一个经过了时间考验和不断进化过来的集团，复杂度非常的高，完全模仿的话就算能做出一个模样（如果真的能做出来的话），照搬了所有它现存的功能，真正运行起来也称不了太久，现实生活有太多的未知数，阿里巴巴是经过当年创立时候的未知数进化过来的，而现在要模仿会需要面对不同的未知数，比方说现存的阿里巴巴（笑），因为这戏额未知数的存在，我们不可能面面俱到的什么都预测准备得到，没有前期的沉淀和积累失败，直接从0开始做最复杂的系统失败也是在所难免的。

这个过程其实非常像自然选择，人类也是通过了各种环境的考验从最开始的单细胞一步一步慢慢的进化过来的，如果现在想要直接重新用各种原料组成一个人，基本是个不可能的任务。

这就是为什么在「The Lean Startup」里面，作者Eric Ries提出要最快速的推出Minimum Variable Product(MVP 最简可行产品)，然后快速收集反馈然后让产品根据反馈不断的改变并且进化。我记得书中他说他们当时创业的时候有一个产品是让用户互相交流的，其中有一个功能他们花了好几个月打磨，觉得完美了之后才上线，结果上线后发现用户觉得这个功能根本没有用，从来不用，这个功能很快就被砍掉了，他从中的出的结论就是如果能早点上线，哪怕这个功能不完善，早点发现这功能没用的话就不用浪费这几个月的时间了，如果反馈好的话再打磨提高也不迟。

## Technical Debt

Technical Debt（技术负债）是软件开发里面的一个概念，也叫做设计负债或者代码负债，是指程序员们为了加快开发的速度，采取了短期内比较有效的手段而不是最佳方案，这会造成未来开发的负担。为什么叫负债呢，因为这个我们日常的贷款是一样的，比方说要立刻买一个东西，我们用了花呗，然后短期来看确实满足了需求，不过长期来看要不断的还利息。

额度小的时候无所谓，毕竟不是所有的负债都是不利的，不过没有及时的把这些负债还清，比方说没把急匆匆写下的代码清理干净或者做好支持性的文档，当负债慢慢积累起来的时候，总有一天这些债务会找上门，像高利贷的债主一样，而快速的偿还清这些债务就是不可能的了。

技术负债虽然是软件开发的概念，不过其实可以运用在生活和工作的方方面面，比方说分析师做报告，本来一切都按照计划进行，不过中午的时候突然得知下午就需要把报告交出去，按照原计划根本来不及，怎么办呢，先糊上去吧，用最快的速度先把报告做了出来，第二天想要重新把报告按原计划整理好，这个时候就需要偿还一部分的技术负债了，需要先把之前糊上去的那部分先清理干净然后再重新来，如果这个时候又有紧急的情况或者其他工作没有机会清理，后续接着往上面加内容的话，很快这个报告就没办法再清理干净了。

技术负载增加了许多的复杂程度，不过复杂(complex)并不等于难懂(complicated)，短期有效的手段对长期系统的简洁和有效造成了不小的影响，比方说上面的报告，本来按照计划进行可以非常的简洁易懂，不过后来为了赶时间可能直接往里面拷贝数据而不是链接到原始数据，也可能直接链接到自己本地的文档而不是共享文档，分享给别人的时候，别人没有办法打开，这种情况持续一段时间，文件就会变得越来越复杂，不见得是真的难懂，但是想完全清理干净要花费非常大的时间和精力。

技术负债和Gall's Law有什么关系呢？当一个程序或者文件或者公司或者系统，什么都好，因为上面讨论的技术负债的原因变得过于复杂的时候，根据Gall's Law，想要重新从头开始重做基本上就是不可能的了， 只能从简单的开始然后再进化，过程中很有可能又有需要注重短线的情况复杂度会再度提高，简直是个死循环。

## Jeff Bezos Mandate

> \1. All teams will henceforth expose their data and functionality through service interfaces.
> \2. Teams must communicate with each other through these interfaces.
> \3. There will be no other form of interprocess communication allowed: no direct linking, no direct reads of another teams' data store, no shared-memory model, no back-doors whatsoever. The only communication allowed is via service interface calls over network.
> \4. It doesn't matter what technology they use. HTTP, Corba, Pubsub, custom protocols -- doesn't matter. Bezos doesn't care.
> \5. All service interfaces, without exception, must be designed from the ground up to be externalizable. That is to say, the team must plan and design to be able to expose the interface to developers in the outside world. No exceptions.
> \6. Anyone who doesn't do this will be fired.
> \7. Thank you; have a nice day!

Jeff Bezos, 亚马逊的创始人和CEO，在AWS发布的两年前，大概是2002年的时候，给全体员工发了这个邮件，下面是大体的翻译：

1. 从现在开始所有的团队都需要使用服务接口来提供数据和功能。
2. 团队直接必须通过服务接口来交流。
3. 不允许其他形式的进程交流：不能直接连接，不能直接读取其他团队的数据，不能共享内存，不能有任何形式的后门。唯一允许的交流方式就是通过网络调取服务接口。
4. 用什么技术都无所谓，HTTP, Corba, Pubsub, 定制协议都不要紧，Jeff Bezos不管。
5. 没有任何的例外，所有的服务接口从开始就必须以公开化作为设计的原则。这也就是说，所有的团队从计划和设计之初就要让系统可以对外部人员开放。没有例外。
6. 不遵守这些的人会被开除。
7. 谢谢，祝你今天愉快。

Amazon做到今天这么大这么成功不是没有道理的，Jeff Bezos在早期就意识到了技术负债的问题，并且用了这封邮件或者说正式的命令让所有员工都按照最优化的办法来交流，交流的复杂程度不会因为公司的壮大而变复杂。

## Big O Notation

有一点计算机背景的人对Big O Notation都不会陌生，Big O Notation描述的是复杂度或者说表现和输入数量的关系。

O(1)说的是，不管输入的量有多少，整个系统都会按照一样的时间运行，比方说现在书架上有一排书，你每次只拿最后的一本，不管书架上是1本还是100本书，所花的时间都是一样的。

O(N^2)说的是运行时间或者复杂度成指数倍的增长，这是一个不怎么有效率的系统，比方说现实生活中的人际关系。数量基本上是n*(n-1)/2。两个人之间存在一个关系，三个人就变成了3个，当公司或者一个团体发展到比较大的时候，比方说100个人以上，总人际关系就有5000+了，想象一下一个1万人以上的公司内部会有多复杂。

这也就是为什么Jeff Bezos会在亚马逊还没成长起来的时候就强调了使用服务接口来交流而不是每个团队直接互相连接，使用通用的交流方式可以有效地降低复杂性，亚马逊不断的扩张发展，公司的交流复杂性保持了不变，类似于O(1)，交流的复杂性不再会限制公司的发展。反过来看其他的很多初创公司，在公司规模小的时候发展的非常的好，不过公司规模提高，效率直线下降，复杂度越来越高，到后面公司的运营都会有困难，这也是我们所说的“臃肿”，不过公司大不一定意味着臃肿，学学亚马逊，在初期就建立一个良好的交流平台和渠道，控制住复杂度和技术负债，后期公司或者团队发展的时候也会更顺利一些。

## Action & Next Step

复杂度和技术负载都是比较抽象的概念，不是特别的容易实施，不过其实它可以运用在生活和工作的方方面面。

比方说生活中我们的东西越买越多，或者人际关系越来越复杂，工作中也是，本来简单能处理的活变得越来越复杂，不见得变难了，但是花费时间越来越长，或者管理的团队在增长，然后管理越来越困难，这些背后的原因很多，复杂度和技术负债都是造成这些现象的一部分，生活和工作中有意识的注意一下的话，会发现许许多多的例子。

就像改变一个习惯最先要开始意识到习惯的出现一样，了解了复杂度和技术负债之后下一步就是在生活和工作中留意一下，留意的多了，也就大概知道为什么会出现技术负债，有没有可能偿还，从而提高生活的质量和工作的效率。